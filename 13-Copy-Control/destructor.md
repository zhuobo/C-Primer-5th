## 析构函数完成什么工作

析构函数完成与构造函数相反的工作：构造函数初始化对象的非 static 数据成员，析构函数释放对象使用的资源，并销毁对象的非 static 数据成员。如同构造函数有一个初始化部分和一个函数体，析构函数也有一个函数体和一个析构部分。在一个构造函数中，成员的初始化是在函数体执行之前完成的，且按照它们在类中出现的顺序进行初始化。而在一个析构函数中，首先执行函数体，然后销毁成员。成员按照**初始化顺序的逆序**销毁。

## 何时调用析构函数
当一个对象被销毁的时候：
* 变量在离开其作用域；
* 当一个对象被销毁，它的成员也被销毁；
* 容器被销毁，它的元素也被销毁；
* 动态分配的对象，指向它的指针被 delete 时；
* 对于临时对象，当创建它的完整表达式结束时。

需要注意的是，当指向一个对象的指针或者引用离开作用域时，析构函数不会执行

## 合成析构函数
当一个类没有定义自己的析构函数时，编译器会定义一个合成析构函数。
如上面所说的，**析构函数本身并不直接销毁成员**，成员是在析构函数体之后隐含的析构阶段被销毁的。在整个对象的销毁过程中，析构函数体是作为成员销毁步骤之外的另一个部分。

## 注意
需要析构函数的类同时也需要拷贝和赋值操作：
因为合成析构函数无法 delete 一个指针数据成员，因此需要定义一个析构函数释放构造函数申请的内存。而如果在使用自定义析构函数的基础上还继续使用合成的拷贝构造和赋值操作（他们都是简单拷贝指针成员），就意味着有多个对象的成员都指向同一个内存地址，可能造成 double free 。

